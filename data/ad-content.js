// D·ªØ li·ªáu n·ªôi dung qu·∫£ng c√°o
export const adContent = {
  header: {
    title: 'Mua s·∫Øm Shopee',
    product: 'K√≠nh m·∫Øt th·ªùi trang',
    description: 'Kh√°m ph√° ng√†n ∆∞u ƒë√£i h·∫•p d·∫´n',
    cta: 'Mua ngay',
    icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997383/kinh_hcgygs.webp',
    link: 'https://s.shopee.vn/gFEWr4DF0'
  },
  content: {
    title: 'Flash Sale',
    product: 'K√≠nh m·∫Øt th·ªùi trang',
    description: 'Gi·∫£m ƒë·∫øn 90%',
    cta: 'Xem ngay',
    icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997400/kinh_j3e0kn.webp',
    link: 'https://s.shopee.vn/gFEWr4DF0'
  },
  sidebar: {
    title: '∆Øu ƒë√£i ƒë·∫∑c bi·ªát',
    product: 'K√≠nh m·∫Øt th·ªùi trang',
    description: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn',
    cta: 'Kh√°m ph√°',
    icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997383/kinh_hcgygs.webp',
    link: 'https://s.shopee.vn/gFEWr4DF0'
  },
  footer: {
    title: 'Shopee - Mua s·∫Øm online',
    product: 'K√≠nh m·∫Øt th·ªùi trang',
    description: 'H√†ng tri·ªáu s·∫£n ph·∫©m, gi√° t·ªët nh·∫•t',
    cta: 'Truy c·∫≠p ngay',
    icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997383/kinh_hcgygs.webp',
    link: 'https://s.shopee.vn/gFEWr4DF0'
  }
};

// Danh s√°ch c√°c bi·∫øn th·ªÉ qu·∫£ng c√°o
export const adVariants = [
  {
    id: 1,
    name: 'K√≠nh m·∫Øt th·ªùi trang',
    header: {
      title: 'Mua s·∫Øm Shopee',
      product: 'K√≠nh m·∫Øt th·ªùi trang',
      description: 'Kh√°m ph√° ng√†n ∆∞u ƒë√£i h·∫•p d·∫´n',
      cta: 'Mua ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997400/kinh_j3e0kn.webp',
      link: 'https://s.shopee.vn/gFEWr4DF0'
    },
    content: {
      title: 'Flash Sale',
      product: 'K√≠nh m·∫Øt th·ªùi trang',
      description: 'Gi·∫£m ƒë·∫øn 90%',
      cta: 'Xem ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997400/kinh_j3e0kn.webp',
      link: 'https://s.shopee.vn/gFEWr4DF0'
    },
    sidebar: {
      title: '∆Øu ƒë√£i ƒë·∫∑c bi·ªát',
      product: 'K√≠nh m·∫Øt th·ªùi trang',
      description: 'Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn',
      cta: 'Kh√°m ph√°',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997383/kinh_hcgygs.webp',
      link: 'https://s.shopee.vn/gFEWr4DF0'
    },
    footer: {
      title: 'Shopee - Mua s·∫Øm online',
      product: 'K√≠nh m·∫Øt th·ªùi trang',
      description: 'H√†ng tri·ªáu s·∫£n ph·∫©m, gi√° t·ªët nh·∫•t',
      cta: 'Truy c·∫≠p ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1752997383/kinh_hcgygs.webp',
      link: 'https://s.shopee.vn/gFEWr4DF0'
    }
  },
  {
    id: 2,
    name: 'Van c·∫£m bi·∫øn √°p su·∫•t l·ªëp',
    header: {
      title: 'Shopee Gia D·ª•ng',
      product: 'Van c·∫£m bi·∫øn √°p su·∫•t l·ªëp',
      description: 'Gi·ªØ an to√†n ‚Äì Ti·∫øt ki·ªám nhi√™n li·ªáu ‚Äì B·∫£o v·ªá l·ªëp xe!',
      cta: 'Kh√°m ph√°',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153460/van_ybbxo1.webp',
      link: 'https://s.shopee.vn/5L170QBW4A'
    },
  
    // üî• content section ‚Äì nh·∫•n m·∫°nh ∆∞u ƒë√£i v√† ƒëa nƒÉng
    content: {
      title: 'Ph√π h·ª£p xe m√°y & √¥ t√¥',
      product: 'Van c·∫£m bi·∫øn √°p su·∫•t l·ªëp',
      description: 'Gi·∫£m gi√° c·ª±c s√¢u ‚Äì B·∫£o v·ªá l·ªëp m·ªçi ph∆∞∆°ng ti·ªán',
      cta: 'Mua ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153460/van_ybbxo1.webp',
      link: 'https://s.shopee.vn/5L170QBW4A'
    },
  
    // üìå sidebar ‚Äì nh·∫•n v√†o s·ª± ti·ªán l·ª£i & ph·ªï th√¥ng
    sidebar: {
      title: 'D√†nh cho m·ªçi lo·∫°i xe',
      product: 'Van c·∫£m bi·∫øn √°p su·∫•t l·ªëp',
      description: 'G·∫Øn ƒë∆∞·ª£c cho c·∫£ xe m√°y & √¥ t√¥',
      cta: 'Xem chi ti·∫øt',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153460/van_ybbxo1.webp',
      link: 'https://s.shopee.vn/5L170QBW4A'
    },
  
    // üöó footer ‚Äì ch·ªët ch·∫∑n th√¥ng ƒëi·ªáp ‚Äúai c≈©ng n√™n c√≥‚Äù
    footer: {
      title: 'Shopee - B·∫£o v·ªá l·ªëp xe th√¥ng minh',
      product: 'Van c·∫£m bi·∫øn √°p su·∫•t l·ªëp',
      description: 'L·ª±a ch·ªçn an to√†n cho m·ªçi ph∆∞∆°ng ti·ªán',
      cta: 'Truy c·∫≠p ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153460/van_ybbxo1.webp',
      link: 'https://s.shopee.vn/5L170QBW4A'
    }
  },
  {
    id: 3,
    name: 'C√¢y lau b√†n b·∫øp',
    header: {
      title: 'Shopee House',
      product: 'C√¢y lau b√†n b·∫øp th√¥ng minh',
      description: 'C√¢y Lau B√†n B·∫øp T·ª± V·∫Øt Mini ƒêa NƒÉng B·ªçt Bi·ªÉn Th·∫•m H√∫t Th√¥ng Minh, D·ª•ng C·ª• Lau D·ªçn G·∫•p G·ªçn',
      cta: 'Mua s·∫Øm',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153817/lau_keleva.webp',
      link: 'https://s.shopee.vn/2LNVRRhqGO'
    },
  
    // ‚ú® content ‚Äì nh·∫•n ti·ªán √≠ch & gi·∫£m gi√°
    content: {
      title: 'Nh√† s·∫°ch ‚Äì B·∫øp g·ªçn',
      product: 'C√¢y lau b√†n b·∫øp th√¥ng minh',
      description: 'Gi·∫£m 40% ‚Äì Lau s·∫°ch m·ªçi ng√≥c ng√°ch',
      cta: 'Xem ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153817/lau_keleva.webp',
      link: 'https://s.shopee.vn/2LNVRRhqGO'
    },
  
    // üßΩ sidebar ‚Äì nh·∫•n v√†o nh·ªè g·ªçn, d·ªÖ d√πng
    sidebar: {
      title: 'G·ªçn nh·∫π ‚Äì Ti·ªán l·ª£i',
      product: 'C√¢y lau b√†n b·∫øp th√¥ng minh',
      description: 'G·∫•p g·ªçn ‚Äì T·ª± v·∫Øt ‚Äì Si√™u th·∫•m h√∫t',
      cta: 'Kh√°m ph√°',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153817/lau_keleva.webp',
      link: 'https://s.shopee.vn/2LNVRRhqGO'
    },
  
    // üè† footer ‚Äì ch·ªët ƒëi·ªÉm n√¢ng c·∫•p kh√¥ng gian b·∫øp
    footer: {
      title: 'Shopee - D·ªçn b·∫øp kh√¥ng lo b·∫©n tay',
      product: 'C√¢y lau b√†n b·∫øp th√¥ng minh',
      description: 'Gi·∫£i ph√°p lau d·ªçn th·∫ø h·ªá m·ªõi',
      cta: 'Truy c·∫≠p ngay',
      icon: 'https://res.cloudinary.com/diwxfpt92/image/upload/v1753153817/lau_keleva.webp',
      link: 'https://s.shopee.vn/2LNVRRhqGO'
    }
  }
  
];

// L∆∞u l·ªãch s·ª≠ ad variant ƒë√£ hi·ªÉn th·ªã trong localStorage
function getRecentAdVariants() {
  const recent = JSON.parse(localStorage.getItem('ad_recent_variants') || '[]');
  const now = Date.now();
  // L·ªçc b·ªè c√°c variant c≈© h∆°n 5 ph√∫t (300000ms)
  const filtered = recent.filter(item => now - item.timestamp < 300000);
  if (filtered.length !== recent.length) {
    localStorage.setItem('ad_recent_variants', JSON.stringify(filtered));
  }
  return filtered;
}

function saveRecentAdVariant(variantId) {
  const recent = getRecentAdVariants();
  recent.push({
    id: variantId,
    timestamp: Date.now()
  });
  localStorage.setItem('ad_recent_variants', JSON.stringify(recent));
}

// H√†m l·∫•y n·ªôi dung qu·∫£ng c√°o random kh√¥ng l·∫∑p l·∫°i trong 5 ph√∫t
export function getRandomAdContent() {
  const recentVariants = getRecentAdVariants();
  const recentIds = recentVariants.map(item => item.id);
  const availableVariants = adVariants.filter(variant => !recentIds.includes(variant.id));
  let chosen;
  if (availableVariants.length === 0) {
    // N·∫øu t·∫•t c·∫£ ƒë√£ hi·ªÉn th·ªã, reset l·ªãch s·ª≠ v√† random l·∫°i
    localStorage.removeItem('ad_recent_variants');
    chosen = adVariants[Math.floor(Math.random() * adVariants.length)];
  } else {
    chosen = availableVariants[Math.floor(Math.random() * availableVariants.length)];
  }
  saveRecentAdVariant(chosen.id);
  return chosen;
}

// H√†m l·∫•y n·ªôi dung qu·∫£ng c√°o theo ID
export function getAdContentById(id) {
  return adVariants.find(variant => variant.id === id) || adVariants[0];
}

// H√†m l·∫•y link affiliate t·ª´ n·ªôi dung qu·∫£ng c√°o
export function getAdAffiliateLink() {
  const randomAd = getRandomAdContent();
  return randomAd.header.link; // L·∫•y link t·ª´ header l√†m m·∫∑c ƒë·ªãnh
}

// H√†m l·∫•y bi·∫øn th·ªÉ qu·∫£ng c√°o hi·ªán t·∫°i (∆∞u ti√™n localStorage, h·ª£p l·ªá trong 5 ph√∫t)
function getCurrentAdVariant() {
  const current = JSON.parse(localStorage.getItem('ad_current_variant') || 'null');
  const now = Date.now();
  if (current && now - current.timestamp < 300000) {
    const variant = adVariants.find(v => v.id === current.id);
    if (variant) return variant;
  }
  return null;
}

// H√†m random v√† l∆∞u l·∫°i bi·∫øn th·ªÉ qu·∫£ng c√°o hi·ªán t·∫°i
function pickAndSaveAdVariant() {
  const variant = getRandomAdContent();
  localStorage.setItem('ad_current_variant', JSON.stringify({id: variant.id, timestamp: Date.now()}));
  return variant;
}

// H√†m c·∫≠p nh·∫≠t n·ªôi dung qu·∫£ng c√°o
export function updateAdContent(forceNew = false) {
  let ad;
  if (forceNew) {
    ad = pickAndSaveAdVariant();
  } else {
    ad = getCurrentAdVariant();
    if (!ad) ad = pickAndSaveAdVariant();
  }
  // C·∫≠p nh·∫≠t header
  const headerTitle = document.querySelector('.ad-shopee-title');
  const headerProduct = document.querySelector('.ad-shopee-product');
  const headerDesc = document.querySelector('.ad-shopee-desc');
  const headerCta = document.querySelector('.ad-shopee-cta');
  const headerBanner = document.querySelector('.ad-shopee');
  const headerIcon = document.querySelector('.ad-shopee-icon');
  if (headerTitle) headerTitle.textContent = ad.header.title;
  if (headerProduct) headerProduct.textContent = ad.header.product;
  if (headerDesc) headerDesc.textContent = ad.header.description;
  if (headerCta) headerCta.textContent = ad.header.cta;
  if (headerBanner) headerBanner.href = ad.header.link;
  if (headerIcon) headerIcon.innerHTML = `<img src="${ad.header.icon}" alt="Shopee" class="ad-icon-img">`;
  // C·∫≠p nh·∫≠t content
  const contentTitle = document.querySelector('.ad-shopee-square-title');
  const contentProduct = document.querySelector('.ad-shopee-square-product');
  const contentDesc = document.querySelector('.ad-shopee-square-desc');
  const contentCta = document.querySelector('.ad-shopee-square-cta');
  const contentBanner = document.querySelector('.ad-shopee-square');
  const contentIcon = document.querySelector('.ad-shopee-square-icon');
  if (contentTitle) contentTitle.textContent = ad.content.title;
  if (contentProduct) contentProduct.textContent = ad.content.product;
  if (contentDesc) contentDesc.textContent = ad.content.description;
  if (contentCta) contentCta.textContent = ad.content.cta;
  if (contentBanner) contentBanner.href = ad.content.link;
  if (contentIcon) contentIcon.innerHTML = `<img src="${ad.content.icon}" alt="Shopee" class="ad-icon-img">`;
  // C·∫≠p nh·∫≠t sidebar
  const sidebarTitle = document.querySelector('.ad-shopee-sidebar-title');
  const sidebarProduct = document.querySelector('.ad-shopee-sidebar-product');
  const sidebarDesc = document.querySelector('.ad-shopee-sidebar-desc');
  const sidebarCta = document.querySelector('.ad-shopee-sidebar-cta');
  const sidebarBanner = document.querySelector('.ad-shopee-sidebar');
  const sidebarIcon = document.querySelector('.ad-shopee-sidebar-icon');
  if (sidebarTitle) sidebarTitle.textContent = ad.sidebar.title;
  if (sidebarProduct) sidebarProduct.textContent = ad.sidebar.product;
  if (sidebarDesc) sidebarDesc.textContent = ad.sidebar.description;
  if (sidebarCta) sidebarCta.textContent = ad.sidebar.cta;
  if (sidebarBanner) sidebarBanner.href = ad.sidebar.link;
  if (sidebarIcon) sidebarIcon.innerHTML = `<img src="${ad.sidebar.icon}" alt="Shopee" class="ad-icon-img">`;
  // C·∫≠p nh·∫≠t footer
  const footerTitle = document.querySelector('.ad-shopee-footer-title');
  const footerProduct = document.querySelector('.ad-shopee-footer-product');
  const footerDesc = document.querySelector('.ad-shopee-footer-desc');
  const footerCta = document.querySelector('.ad-shopee-footer-cta');
  const footerBanner = document.querySelector('.ad-shopee-footer');
  const footerIcon = document.querySelector('.ad-shopee-footer-icon');
  if (footerTitle) footerTitle.textContent = ad.footer.title;
  if (footerProduct) footerProduct.textContent = ad.footer.product;
  if (footerDesc) footerDesc.textContent = ad.footer.description;
  if (footerCta) footerCta.textContent = ad.footer.cta;
  if (footerBanner) footerBanner.href = ad.footer.link;
  if (footerIcon) footerIcon.innerHTML = `<img src="${ad.footer.icon}" alt="Shopee" class="ad-icon-img">`;
} 